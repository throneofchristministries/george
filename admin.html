<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Throne of Christ Ministries Admin</title>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<style>
body {font-family:Arial, sans-serif; background:#f0f2f5; padding:20px;}
h2 {text-align:center; margin-bottom:20px;}
input, textarea, button {width:100%; padding:10px; margin:6px 0; border-radius:5px; border:1px solid #ccc;}
button {background:#0a2e5d; color:gold; font-weight:bold; cursor:pointer;}
button:hover {background:#003366; color:white;}
.tabs {display:flex; flex-wrap:wrap; gap:10px; margin:15px 0;}
.tabs button {flex:1; min-width:120px;}
.section {display:none; background:white; padding:15px; border-radius:8px; box-shadow:0 3px 8px rgba(0,0,0,0.1);}
.section.active {display:block;}
.item {border:1px solid #ccc; padding:8px; margin:8px 0; border-radius:5px; display:flex; justify-content:space-between; align-items:center;}
.item span {flex:1;}
.success {color:green; font-weight:bold;}
.error {color:red; font-weight:bold;}
</style>
</head>

<body>
<h2>Throne of Christ Ministries Admin Panel</h2>

<!-- Login -->
<div id="login">
  <input id="pass" type="password" placeholder="Admin Password">
  <button onclick="login()">Login</button>
</div>

<!-- Admin Panel -->
<div id="panel" style="display:none">

  <!-- Tabs -->
  <div class="tabs">
    <button onclick="show('msgSec')">Messages</button>
    <button onclick="show('progSec')">Programs</button>
    <button onclick="show('testSec')">Testimonials</button>
  </div>

  <!-- Messages Section -->
  <div id="msgSec" class="section">
    <h3>Add Message</h3>
    <input id="mTitle" placeholder="Title">
    <input id="mDate" type="date">
    <input id="mVideo" placeholder="Video Embed Link (Facebook/YouTube)">
    <input id="mAudio" placeholder="Audio Link (Google Drive Direct Link)">
    <button onclick="saveMsg()">Save Message</button>
    <p id="msgFeedback"></p>

    <h4>Existing Messages</h4>
    <div id="msgList"></div>
  </div>

  <!-- Programs Section -->
  <div id="progSec" class="section">
    <h3>Add Program</h3>
    <input id="pTitle" placeholder="Title">
    <input id="pDate" type="date">
    <input id="pFlyer" placeholder="Flyer Image URL">
    <button onclick="saveProg()">Save Program</button>
    <p id="progFeedback"></p>

    <h4>Existing Programs</h4>
    <div id="progList"></div>
  </div>

  <!-- Testimonials Section -->
  <div id="testSec" class="section">
    <h3>Add Testimonial</h3>
    <input id="tName" placeholder="Name">
    <textarea id="tMsg" placeholder="Message"></textarea>
    <button onclick="saveTest()">Save Testimonial</button>
    <p id="testFeedback"></p>

    <h4>Existing Testimonials</h4>
    <div id="testList"></div>
  </div>

</div>

<script>
// ===== Firebase Setup =====
firebase.initializeApp({
  apiKey: "AIzaSyBVkn_LvrbOFKmZLoJxMsrZXqugUQvml74",
  authDomain: "throneofchristministries-6a88a.firebaseapp.com",
  projectId: "throneofchristministries-6a88a"
});
const db = firebase.firestore();
const ADMIN_PASS = "1234";

// ===== Login =====
function login(){
  const pass = document.getElementById("pass").value;
  if(pass === ADMIN_PASS){
    document.getElementById("login").style.display="none";
    document.getElementById("panel").style.display="block";
    show('msgSec'); // default tab
    loadAll();
  } else {
    alert("Wrong password!");
  }
}

// ===== Tabs =====
function show(id){
  document.querySelectorAll('.section').forEach(s => s.classList.remove("active"));
  document.getElementById(id).classList.add("active");
}

// ===== Messages =====
function saveMsg(){
  const title = document.getElementById("mTitle").value.trim();
  const date = document.getElementById("mDate").value;
  const video = document.getElementById("mVideo").value.trim();
  const audio = document.getElementById("mAudio").value.trim();
  const feedback = document.getElementById("msgFeedback");

  if(!title || !date){ 
    feedback.innerText="Title and Date are required!"; 
    feedback.className="error"; 
    return; 
  }

  // Optional: convert Google Drive sharing link to direct download
  let audioLink = audio;
  if(audio.includes("drive.google.com") && !audio.includes("uc?export=download")){
    const idMatch = audio.match(/[-\w]{25,}/);
    if(idMatch) audioLink = `https://drive.google.com/uc?export=download&id=${idMatch[0]}`;
  }

  db.collection("messages").add({title,date,video,audio:audioLink})
    .then(()=> {
      feedback.innerText="Message saved successfully!";
      feedback.className="success";
      document.getElementById("mTitle").value="";
      document.getElementById("mDate").value="";
      document.getElementById("mVideo").value="";
      document.getElementById("mAudio").value="";
      loadMsgs();
    }).catch(e=>{
      feedback.innerText="Error saving message!";
      feedback.className="error";
    });
}

function loadMsgs(){
  const list = document.getElementById("msgList");
  list.innerHTML="";
  db.collection("messages").orderBy("date","desc").get().then(snap=>{
    if(snap.empty) list.innerHTML="<p>No messages yet.</p>";
    snap.forEach(doc=>{
      const data = doc.data();
      const div = document.createElement("div");
      div.className="item";
      div.innerHTML=`<span>${data.title} - ${data.date}</span> 
        <button onclick="del('messages','${doc.id}')">Delete</button>`;
      list.appendChild(div);
    });
  });
}

// ===== Programs =====
function saveProg(){
  const title = document.getElementById("pTitle").value.trim();
  const date = document.getElementById("pDate").value;
  const flyer = document.getElementById("pFlyer").value.trim();
  const feedback = document.getElementById("progFeedback");

  if(!title || !date || !flyer){ feedback.innerText="Fill all fields!"; feedback.className="error"; return; }

  db.collection("programs").add({title,date,flyer})
    .then(()=> {
      feedback.innerText="Program saved successfully!";
      feedback.className="success";
      document.getElementById("pTitle").value="";
      document.getElementById("pDate").value="";
      document.getElementById("pFlyer").value="";
      loadProg();
    }).catch(e=>{
      feedback.innerText="Error saving program!";
      feedback.className="error";
    });
}

function loadProg(){
  const list = document.getElementById("progList");
  list.innerHTML="";
  db.collection("programs").orderBy("date","asc").get().then(snap=>{
    if(snap.empty) list.innerHTML="<p>No programs yet.</p>";
    snap.forEach(doc=>{
      const data = doc.data();
      const div = document.createElement("div");
      div.className="item";
      div.innerHTML=`<span>${data.title} - ${data.date}</span>
        <button onclick="del('programs','${doc.id}')">Delete</button>`;
      list.appendChild(div);
    });
  });
}

// ===== Testimonials =====
function saveTest(){
  const name = document.getElementById("tName").value.trim();
  const message = document.getElementById("tMsg").value.trim();
  const feedback = document.getElementById("testFeedback");

  if(!name || !message){ feedback.innerText="Fill all fields!"; feedback.className="error"; return; }

  db.collection("testimonials").add({name,message})
    .then(()=> {
      feedback.innerText="Testimonial saved successfully!";
      feedback.className="success";
      document.getElementById("tName").value="";
      document.getElementById("tMsg").value="";
      loadTest();
    }).catch(e=>{
      feedback.innerText="Error saving testimonial!";
      feedback.className="error";
    });
}

function loadTest(){
  const list = document.getElementById("testList");
  list.innerHTML="";
  db.collection("testimonials").get().then(snap=>{
    if(snap.empty) list.innerHTML="<p>No testimonials yet.</p>";
    snap.forEach(doc=>{
      const data = doc.data();
      const div = document.createElement("div");
      div.className="item";
      div.innerHTML=`<span>${data.name}: ${data.message}</span>
        <button onclick="del('testimonials','${doc.id}')">Delete</button>`;
      list.appendChild(div);
    });
  });
}

// ===== Delete Document with confirmation =====
function del(coll,id){
  if(confirm("Are you sure you want to delete this item?")){
    db.collection(coll).doc(id).delete().then(loadAll);
  }
}

// ===== Load all sections =====
function loadAll(){
  loadMsgs();
  loadProg();
  loadTest();
}
</script>
</body>
</html>
